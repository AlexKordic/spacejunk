<script>

var satellites = <%= @satellites.to_json.html_safe %>

  $(function(){

    var width = 960,
        height = 800;

    // MAIN GLOBE
    var projection = d3.geo.orthographic()
        .scale((height-100)/2)
        .translate([width / 2, height / 2])
        .clipAngle(90);

    var path = d3.geo.path()
        .projection(projection);

    // SATELLITE GLOBE
    var satProjection = d3.geo.orthographic()
        .scale((height-10)/2)
        .translate(([width/2,height/2]))
        .clipAngle(118);

    var satPath = d3.geo.path()
        .projection(satProjection)
        .pointRadius(3);

    // x-revolution
    var λ = d3.scale.linear()
        .domain([0, width])
        .range([-180, 180]);

    // // y-revolution
    // var φ = d3.scale.linear()
    //     .domain([0, height])
    //     .range([90, -90]);


    var svg = d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height);


    svg.on("mousemove", function() {
      var p = d3.mouse(this);
      satProjection.rotate([λ(p[0]), 0]);
      projection.rotate([λ(p[0]), 0]);
      svg.selectAll(".globe").attr("d", path);
      svg.selectAll(".point").attr("d", satPath);
    });

  d3.json("world.json", function(error, world) {

    svg.append("path")
        .datum(topojson.feature(world, world.objects.ocean))
        .attr("class", "globe")
        .attr("id", "ocean")
        .attr("d", path);

    svg.append("path")
        .datum(topojson.feature(world, world.objects.land))
        .attr("class", "globe")
        .attr("id", "land")
        .attr("d", path);

    var data = [[0,0], [10,10], [15,-20], [50,-40], [-100, 25]];

    svg.selectAll("path.point")
      .data(data)
      .enter()
      .append("path")
      .datum(function(d) {
        return {"type": "Point", "coordinates": d, "radius": 3};
      })
      .attr("class", "point")
      .attr("d", satPath);
  });

})
</script>
