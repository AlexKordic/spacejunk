require 'date'
require 'time'
Satellite.destroy_all

# read csv in future

data = "1 34219U 01049PP  11337.00696062  .00021019  00000-0  19659-2 0   825
2 34219 097.7342 054.3895 0024061 099.6130 260.6108 14.93906142324852

1 35040U 93036AHD 12112.14184998  .00026940  00000-0  28923-2 0  1588
2 35040 073.9661 277.9363 0084666 286.1693 075.4595 14.85847839160568

1 31045U 99025BEP 12223.69121466  .00032738  00000-0  30866-2 0  3580
2 31045 099.5389 172.1735 0132736 056.0644 310.0119 14.87222313289031

1 28607U 03048H   13088.77863249  .00026826  00000-0  44933-2 0  5674
2 28607 098.9355 294.7107 0013985 292.8941 060.9908 14.69667725472788

1 35807U 97051SR  13264.89626527  .00068410  00000-0  71367-2 0  3737
2 35807 086.3713 134.5774 0064106 352.3441 188.9566 14.87895960221569

1 36931U 71120U   13335.88516282  .00174666  00000-0  89670-2 0  1004
2 36931 081.2086 042.8685 0010573 266.0062 067.6046 15.15654324201390

1 35608U 93036ANB 14018.89130907  .00083503  00000-0  63452-2 0  4529
2 35608 074.2074 215.6011 0011799 326.8746 098.1068 15.01662570251718

1 36562U 97051WR  14030.56123563  .00522699  00000-0  12840-1 0  3761
2 36562 086.0466 332.5052 0022501 121.2776 282.4411 15.38401312240545

1 34362U 97051FE  14068.92028444  .27049650  00000-0  42923-1 0  7703
2 34362 086.2650 046.5322 0005173 164.5789 195.7514 16.03758501266131

1 33771U 97051J   14078.65723223  .11537531  40108+0  70832-1 0  7967
2 33771 086.3279 040.9132 0039469 161.1238 252.5223 15.86978017269998

1 36925U 71120N   14082.30805342  .00133179  00000-0  94354-2 0   998
2 36925 081.2013 291.8322 0004362 311.3732 048.7051 15.04134545403514

1 26415U 00042B   14082.91910370  .22682768  29076-5  33582-3 0   343
2 26415 097.8178 144.6075 0008683 258.3833 101.6527 16.48397945762951

1 35791U 93036ASM 14093.47073285  .00158189  00000-0  10419-1 0  1876
2 35791 073.9702 017.4681 0074560 240.6399 128.2239 15.04455334255336

1 32309U 99025CXA 14103.60032490  .00143675  00000-0  13604-1 0  1482
2 32309 099.9347 239.6473 0073788 182.0348 176.7096 14.90830866357627

1 34996U 93036AFU 14181.51309524  .00194133  00000-0  33254-2 0  3484
2 34996 073.9735 125.3147 0040639 293.3793 066.1685 15.49532515281506

1 39772U 14029G   14190.24693742  .18502308  00000-0  14716+0 0   666
2 39772 098.0612 289.8319 0036571 284.5249 077.0364 15.64174585  6922

1 03393U 68066J   14191.50909068  .34665282 -76619-6  15980-1 0    62
2 03393 080.3763 228.2614 0015428 239.0315 120.9905 16.21521095207495

1 37304U 93036BJU 14192.12173742  .01597652  00000-0  10758-1 0  4860
2 37304 073.9201 089.7277 0043159 194.7152 165.2819 15.70785499246630

1 39108U 86019VW  14193.88470817  .00270425  00000-0  11422-1 0  1191
2 39108 099.0524 074.1711 0012074 330.9377 035.1847 15.21960315450728

1 38942U 12044CB  14197.43644319  .10672446  11693-4  80604-2 0  9874
2 38942 049.4976 210.4546 0092848 058.6496 302.3531 16.05331219 78001

1 34653U 97051KE  14198.44433137  .03381900  00000-0  28698-1 0   916
2 34653 086.2913 008.4346 0028890 310.0532 080.4298 15.65492931281948

1 34385U 93036QA  14201.91417075  .08795030  25656+0  13259-1 0  4098
2 34385 073.9724 149.8841 0033540 206.0661 217.7422 16.10106988289147

1 33902U 93036DF  14206.85487138  .51598976  14093-5  28532-1 0  5589
2 33902 073.9648 137.4948 0029576 207.4895 213.6076 16.18196444291647

1 28829U 05031G   14207.45057872  .40627042  26229-5  26641-2 0   779
2 28829 097.9738 195.4614 0018849 188.6488 272.8996 16.39434464485731

1 20860U 90081Y   14208.81544926  .66955500  35767-5  11772-1 0  5273
2 20860 098.6380 110.0066 0010579 207.4543 190.9297 16.32638353249409

1 36892U 79095AH  14211.87511069  .00108871  00000-0  25646-2 0  3684
2 36892 081.1049 066.4063 0027080 068.5001 291.7635 15.41119168577273

1 18912U 69070D   14212.57842867  .00716574  22061-3  18115-2 0   825
2 18912 073.9514 292.3394 0012113 314.2217 108.6762 15.95316184479465

1 38910U 12044AT  14214.95902452  .15756368  12664-4  67891-2 0  9032
2 38910 050.1274 239.4929 0096637 334.7035 024.9242 16.11210535 78841

1 03699U 68091AN  14215.01567551  .11780348  87649-5  69185-2 0  2281
2 03699 062.2116 169.2375 0005450 192.4287 240.2661 16.18211663236374

1 28828U 05031F   14215.11738999  .15550524  28680-5  17051-2 0  2509
2 28828 098.0000 273.0296 0012191 309.9082 053.9233 16.37101288489532

1 29044U 05031L   14215.13958290  .12602592  28869-5  26518-2 0  8648
2 29044 098.0121 272.5490 0017035 287.5139 073.9277 16.30486754482599

1 09957U 76126AX  14215.23902333  .66531485  63708-5  33728-1 0  4851
2 09957 065.6957 165.8616 0027462 209.6839 266.6017 16.19243024629468

1 34832U 97051MG  14215.34763890  .00789250  00000-0  19039-1 0  3498
2 34832 086.3797 341.4210 0015628 273.9815 139.5258 15.38883981283442

1 06391U 72104C   14215.54358104  .08448675  18897-5  34843-2 0  9260
2 06391 074.0518 267.4292 0015650 286.0392 073.9135 16.22765113219122

1 34322U 93036NU  14215.61305028  .00277870  00000-0  26977-2 0  8907
2 34322 073.9872 287.6724 0044440 013.9060 107.9606 15.64134799298415

1 34534U 97051JB  14215.74616458  .00604610  00000-0  13243-1 0  2753
2 34534 086.2593 303.0883 0015823 293.1835 194.2559 15.41696714290593

1 28831U 05031J   14215.76330756  .00328671  00000-0  29858-2 0  1725
2 28831 098.0181 256.2351 0005886 173.2663 252.6950 15.66942009488382

1 34597U 97051JP  14215.85681663  .03477574  00000-0  36121-1 0  3250
2 34597 086.3540 353.2258 0034910 280.3783 239.9324 15.59969654288999

1 30179U 99025UL  14215.90725380  .01197035  00000-0  10550+0 0  6478
2 30179 099.4510 303.5024 0143447 192.3732 167.3942 14.85978016367239

1 04112U 69082CZ  14215.94651035  .00777538  00000-0  72436-2 0  3343
2 04112 069.6580 251.7841 0014577 285.7956 141.9539 15.64694143392186

1 13402U 82079A   14216.03272116  .00199940  13504-4  63783-3 0  3816
2 13402 081.1064 013.1060 0001642 217.5344 282.5663 15.91014366757728

1 31084U 99025BGE 14216.03476557  .00682775  00000-0  49350-1 0  3364
2 31084 099.4703 151.4224 0043962 149.4679 210.9112 15.00771395380671

1 38909U 12044AS  14216.05459374  .00918531  14897-3  50710-2 0  1234
2 38909 050.1047 219.7481 0602219 001.3725 358.8700 14.71154845 79601

1 34960U 93036AEP 14216.06572743  .00650000  00000-0  15436-1 0  5471
2 34960 073.9825 176.6457 0030516 215.4114 275.2147 15.39027041280018

1 38900U 12044AH  14216.07908223  .01298060  42854-3  38490-2 0  9118
2 38900 050.2426 293.8645 0359133 289.3076 066.9380 15.33411080 77908

1 28830U 05031H   14216.08110543  .00275188  00000-0  25281-2 0  1416
2 28830 098.0154 259.5447 0006032 191.9891 168.1225 15.66824478488595

1 38965U 12044CY  14216.09089019  .01728872  71406-3  63284-2 0  8824
2 38965 049.9836 223.1692 0414801 008.9776 351.8309 15.18342036 78964

1 38925U 12044BJ  14216.12618556  .05193593  10995-4  81378-2 0  8469
2 38925 049.9407 183.8075 0194713 045.3742 316.2930 15.76740810 79935

1 31798U 07030B   14216.15334851  .00170536  00000-0  65150-3 0  1794
2 31798 098.1883 270.9944 0007741 117.9272 301.5809 15.87004839397044

1 24080U 94029EB  14216.17532919  .00897890  41948-3  13239-2 0  5333
2 24080 081.8436 098.7680 0004277 242.3160 240.3689 16.05071133996869

1 09911U 77027A   14216.18271355  .99999999  14264-4  46478-2 0  9982
2 09911 062.3315 078.6570 0644795 048.8750 102.5507 15.05809407273913

1 39577U 14009F   14216.20104813  .00286559  38570-4  74674-3 0  2556
2 39577 064.9992 228.5332 0020045 296.5169 063.3935 15.94376625 24795

1 36134U 09071C   14216.20638992  .00437328  73276-4  15195-2 0  5633
2 36134 097.4478 252.0768 0005355 187.5918 211.4399 15.89370573256027

1 35277U 93059L   14216.29839122  .00864267  00000-0  24879-1 0  8656
2 35277 070.9142 169.5305 0013242 176.7742 303.3277 15.32973431 83390

1 04458U 69082FB  14216.35985542  .00406629  00000-0  51388-2 0  5182
2 04458 069.7162 187.9508 0016724 197.6200 312.8777 15.57881057367577

1 27581U 01049MZ  14216.39146066  .00398484  60692-4  14131-2 0  1128
2 27581 097.8330 077.1768 0007898 084.0434 041.8776 15.88929980670180

1 30049U 99025PA  14216.40465257  .00665183  00000-0  45992-1 0  7063
2 30049 098.5345 120.3134 0009044 335.4777 084.2040 15.03158599387573

1 11671U 80005A   14216.53438419  .10038654 -12520-5  14780-3 0  6083
2 11671 082.4044 262.3257 0011306 258.5698 101.8829 16.48169257895944"


tle_array = data.split(/\n\n/)
tle_line_array = []
tle_array.each do |line|
  x = line.split(/\n/)
  tle_line_array << x
end

sat_objs = []

tle_line_array.each do |tle|
  sat = {}

  #LAUNCH MANIPULATION
  if tle[0][9..10].to_i > 56
    launch_year = tle[0][9..10].to_i + 1900
  else
    launch_year = tle[0][9..10].to_i + 2000
  end
  launch_day = tle[0][11..13].to_i

  # EPOCH MANIPULATION
  if tle[0][18..19].to_i > 56
    epoch_year = tle[0][18..19].to_i + 1900
  else
    epoch_year = tle[0][18..19].to_i + 2000
  end

  epoch_yday = tle[0][20..31].to_f
  elapsed_jd = (Date.ordinal(epoch_year, epoch_yday).ajd - 2451545).to_f           # days since 2000-01-01


  if tle[0][53] == "-"
    b_star = ("-0." + tle[0][54..58]).to_f * 10**tle[0][59..60].to_f
  else
    b_star = ("0." + tle[0][54..58]).to_f * 10**tle[0][59..60].to_f
  end

if tle[0][33] == "-"
  der_1 = ("-0" + tle[0][34..42].to_s).to_f
else
  der_1 = ("0" + tle[0][34..42].to_s).to_f
end

  der_2 = ("0." + tle[0][45..49]).to_f * 10**tle[0][50..51].to_f




  sat[:norad_id] = tle[0][2..6]
  sat[:launch_date] = Date.ordinal(launch_year, launch_day).to_s
  sat[:epoch_date] = elapsed_jd
  sat[:b_star] = b_star
  sat[:inclination] = tle[1][8..15].to_f
  sat[:right_asc] = tle[1][17..24].to_f
  sat[:eccentricity] = ("0." + tle[1][26..32]).to_f
  sat[:perigee] = tle[1][34..41].to_f
  sat[:mean_anomoly] = tle[1][43..50].to_f
  sat[:mean_motion] = tle[1][52..62].to_f
  sat[:orbit_number] = tle[1][63..67].to_i
  sat[:first_derivative] = der_1
  sat[:second_derivative] = der_2

  Satellite.create(sat)
end

# need checksums at some point
