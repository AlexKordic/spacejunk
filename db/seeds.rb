require 'date'
require 'time'
Satellite.destroy_all

# read csv in future

data = "1 03393U 68066J   14191.50909068  .34665282 -76619-6  15980-1 0    62
2 03393 080.3763 228.2614 0015428 239.0315 120.9905 16.21521095207495

1 03699U 68091AN  14195.45433149  .00569254  00000-0  36719-2 0  1850
2 03699 062.2311 245.7921 0044564 036.1085 074.6523 15.72926036233275

1 04112U 69082CZ  14195.45750235  .00318891  00000-0  49201-2 0  2995
2 04112 069.6684 309.2271 0011588 292.2060 140.6476 15.52804176388991

1 04458U 69082FB  14194.59620808  .00213088  00000-0  36004-2 0  4894
2 04458 069.7166 248.4634 0013034 221.7276 291.2175 15.50615467364197

1 06391U 72104C   14195.46099277  .00497342  00000-0  21241-2 0  8650
2 06391 074.0696 314.3882 0011281 325.3973 034.6522 15.83757072215923

1 09911U 77027A   14193.89160694  .01297961  34945-5  39026-2 0  9430
2 09911 062.5547 090.7175 7433681 044.5080 355.2388 02.14917892272977

1 09957U 76126AX  14195.46692207  .00595405  00000-0  63610-2 0  4348
2 09957 065.7248 233.0275 0029636 195.4860 280.5407 15.61296586626352

1 11671U 80005A   14195.52667310  .00421703  80327-4  61735-3 0  5395
2 11671 082.4587 286.5350 0007348 241.2339 118.8178 16.05054374892555

1 12173U 78026N   14187.99281828  .40092503  30170-5  15631-1 0  5582
2 12173 098.4487 195.7698 0016936 226.2547 133.7340 16.23526680762043

1 13402U 82079A   14194.66019395  .00131697  00000-0  52839-3 0  3557
2 13402 081.1067 040.9845 0002493 203.6074 218.2329 15.86100516754326

1 18192U 87061  A 89062.60955596  .27716035 +61405-5 +17238-3 0 06907
2 18192 073.9523 283.3260 0009929 118.3688 242.4671 16.53945712092358

1 18912U 69070D   14195.07803358  .00361136  00000-0  16214-2 0   668
2 18912 073.9590 333.1786 0002086 021.1573 101.9431 15.83088875476685

1 20860U 90081Y   14195.68852465  .01035073  00000-0  48010-2 0  4942
2 20860 098.6710 093.1878 0006811 135.3224 224.8693 15.81161039247317

1 24080U 94029EB  14195.28854678  .00324855  37108-4  11227-2 0  4817
2 24080 081.8537 124.0056 0011692 075.5273 051.9567 15.89331033993543

1 26415U 00042B   14082.91910370  .22682768  29076-5  33582-3 0   343
2 26415 097.8178 144.6075 0008683 258.3833 101.6527 16.48397945762951

1 27581U 01049MZ  14193.08019679  .00222296  00000-0  11797-2 0   941
2 27581 097.8344 050.5365 0013063 158.0688 354.2500 15.79789795666490

1 28607U 03048H   13101.85817485  .00057776  00000-0  93675-2 0  5585
2 28607 098.9344 309.0365 0011610 254.1034 167.1201 14.70864260474704

1 28828U 05031F   14195.64171184  .00622469  00000-0  29680-2 0  2022
2 28828 098.0172 249.9668 0007613 251.4648 108.5847 15.81208347486435

1 28829U 05031G   14195.50385508  .00976217  00000-0  36005-2 0   395
2 28829 097.9902 181.2268 0013020 175.5235 314.5373 15.85805070483829

1 28830U 05031H   14195.40853863  .00148087  00000-0  17204-2 0  1106
2 28830 098.0182 236.0927 0003542 213.4887 146.6146 15.61246778485368

1 28831U 05031J   14194.77305922  .00192009  00000-0  22621-2 0  1421
2 28831 098.0212 232.4204 0005909 190.5760 262.2380 15.60723229485102

1 29044U 05031L   14195.48634560  .00527317  00000-0  26175-2 0  8092
2 29044 098.0170 249.2331 0009549 231.8818 250.6629 15.80546364479460

1 30049U 99025PA  14195.42021391  .00276036  00000-0  25029-1 0  6678
2 30049 098.5381 097.4162 0032201 054.0334 034.4422 14.93452477384435

1 31045U 99025BEP 12223.69121466  .00032738  00000-0  30866-2 0  3580
2 31045 099.5389 172.1735 0132736 056.0644 310.0119 14.87222313289031

1 31084U 99025BGE 14194.73482490  .00380210  00000-0  37466-1 0  2991
2 31084 099.4927 125.7407 0023857 267.9601 091.8879 14.89682106377497

1 31798U 07030B   14195.12438265  .00106730  00000-0  49960-3 0  1517
2 31798 098.1910 245.8540 0010207 178.4432 237.7760 15.82867221393712

1 33771U 97051J   14078.65723223  .11537531  40108+0  70832-1 0  7967
2 33771 086.3279 040.9132 0039469 161.1238 252.5223 15.86978017269998

1 33902U 93036DF  14195.64487648  .01422153  00000-0  11454-1 0  5388
2 33902 073.9949 163.3422 0034036 215.8218 144.2835 15.67193762289872

1 34322U 93036NU  14194.84651461  .00207817  00000-0  25260-2 0  8642
2 34322 073.9913 334.1162 0048082 073.8859 048.7587 15.58397066295173

1 34362U 97051FE  14068.92028444  .27049650  00000-0  42923-1 0  7703
2 34362 086.2650 046.5322 0005173 164.5789 195.7514 16.03758501266131

1 34385U 93036QA  14195.48572878  .01962463  00000-0  13104-1 0  3976
2 34385 073.9827 164.7940 0037266 208.3165 268.4526 15.71136666288127

1 34534U 97051JB  14194.10260863  .00342358  00000-0  10645-1 0  2384
2 34534 086.2641 314.0945 0007453 028.0432 033.7023 15.31886511287275

1 34597U 97051JP  14195.51448069  .00475407  00000-0  13945-1 0  2798
2 34597 086.3852 003.3012 0009997 315.7328 107.0797 15.33178531285861

1 34653U 97051KE  14195.48559330  .02580355  00000-0  36755-1 0   862
2 34653 086.2761 009.9623 0025728 301.2728 058.9404 15.52721224281483

1 34654U 97051KF  14176.60330198  .06024224  00000-0  21671-1 0  3478
2 34654 086.3781 025.3915 0012302 235.0335 127.1362 15.84171832278796

1 34832U 97051MG  14195.42532855  .00291858  00000-0  10289-1 0  3118
2 34832 086.3868 351.1605 0008776 284.1864 134.1625 15.28002166280398

1 34960U 93036AEP 14194.83480523  .00248544  00000-0  85612-2 0  5161
2 34960 073.9888 222.1349 0023642 287.8350 130.5474 15.28653248276766

1 34996U 93036AFU 14181.51309524  .00194133  00000-0  33254-2 0  3484
2 34996 073.9735 125.3147 0040639 293.3793 066.1685 15.49532515281506

1 35277U 93059L   14194.51883391  .00391129  00000-0  17493-1 0  8233
2 35277 070.9315 224.1381 0013970 316.9556 192.7515 15.19314964 80075

1 35791U 93036ASM 14093.47073285  .00158189  00000-0  10419-1 0  1876
2 35791 073.9702 017.4681 0074560 240.6399 128.2239 15.04455334255336

1 35807U 97051SR  13264.89626527  .00068410  00000-0  71367-2 0  3737
2 35807 086.3713 134.5774 0064106 352.3441 188.9566 14.87895960221569

1 36044U 93036AXF 14187.85739514  .00747731  00000-0  12398-1 0  3785
2 36044 073.9687 251.8778 0025136 308.0354 085.6529 15.49487331257416

1 36134U 09071C   14194.79989767  .00225802  00000-0  11708-2 0  5270
2 36134 097.4507 228.8046 0003647 175.6939 272.0397 15.80403010252631

1 36245U 99025DVW 11331.52273149  .00031226  00000-0  68649-2 0  1066
2 36245 098.8963 070.9620 0126286 070.7143 294.2134 14.52540879185808

1 36468U 93036BBT 14178.42642000  .00125666  00000-0  28579-2 0  3002
2 36468 074.0000 204.7305 0039673 019.0735 341.1774 15.41609578254749

1 36562U 97051WR  14030.56123563  .00522699  00000-0  12840-1 0  3761
2 36562 086.0466 332.5052 0022501 121.2776 282.4411 15.38401312240545

1 36892U 79095AH  14192.04698992  .00315354  00000-0  85315-2 0  3610
2 36892 081.1839 090.2723 0008095 097.1175 263.9286 15.36392854574227

1 36925U 71120N   14082.30805342  .00133179  00000-0  94354-2 0   998
2 36925 081.2013 291.8322 0004362 311.3732 048.7051 15.04134545403514

1 36931U 71120U   13335.88516282  .00174666  00000-0  89670-2 0  1004
2 36931 081.2086 042.8685 0010573 266.0062 067.6046 15.15654324201390

1 37304U 93036BJU 14192.12173742  .01597652  00000-0  10758-1 0  4860
2 37304 073.9201 089.7277 0043159 194.7152 165.2819 15.70785499246630

1 38118U 99025EPP 14099.77287521  .00186001  00000-0  15103-1 0   547
2 38118 099.1060 301.4831 0016384 074.1343 286.1680 14.98541287212085

1 38203U 93036BST 14181.18969039  .01304430  00000-0  72806-2 0  1742
2 38203 073.9313 122.7689 0041774 197.9515 171.4581 15.75336253239448

1 38900U 12044AH  14195.41411173  .01014018  20402-3  45159-2 0  8691
2 38900 050.2473 034.0603 0503202 207.0343 150.3564 14.96112189 74771

1 38910U 12044AT  14195.43901290  .01178054  91349-5  34271-2 0  8647
2 38910 050.1638 339.7031 0402567 256.2569 099.3283 15.24161959 75820

1 38925U 12044BJ  14195.09080261  .00931785  18586-3  38041-2 0  7949
2 38925 049.9833 289.6103 0445995 316.5546 040.1049 15.09916205 76706

1 38942U 12044CB  14195.30328833  .06965155  11089-4  11111-1 0  9814
2 38942 049.5115 222.2595 0176233 043.2011 318.2632 15.80164775 77668

1 38965U 12044CY  14195.37283617  .00550233  59742-4  27745-2 0  8523
2 38965 050.0122 321.4348 0558182 288.4611 065.6452 14.82211884 75871

1 39561U 98067EE  14191.77216622  .14246147  12440-4  13646-2 0  3533
2 39561 051.6194 322.5770 0008344 322.2228 038.0769 16.37535560 20958

1 39575U 14009D   14195.58718796  .00876642  44152-3  90922-3 0  2556
2 39575 064.9954 298.7580 0021040 294.6504 065.2394 16.09843373 21583

1 39577U 14009F   14195.57872972  .00177539  17867-4  64523-3 0  2061
2 39577 065.0090 302.4325 0020027 294.1286 065.7777 15.88028908 21512

1 39772U 14029G   14190.24693742  .18502308  00000-0  14716+0 0   666
2 39772 098.0612 289.8319 0036571 284.5249 077.0364 15.64174585  6922

1 39931U 94029AGE 14179.87775999  .00478990  00000-0  35201-2 0    72
2 39931 081.9634 040.5025 0025424 225.8306 283.4825 15.71328534610274"



tle_array = data.split(/\n\n/)
tle_line_array = []
tle_array.each do |line|
  x = line.split(/\n/)
  tle_line_array << x
end

sat_objs = []

tle_line_array.each do |tle|
  sat = {}

  #LAUNCH MANIPULATION
  if tle[0][9..10].to_i > 56
    launch_year = tle[0][9..10].to_i + 1900
  else
    launch_year = tle[0][9..10].to_i + 2000
  end
  launch_day = tle[0][11..13].to_i

  # EPOCH MANIPULATION
  if tle[0][18..19].to_i > 56
    epoch_year = tle[0][18..19].to_i + 1900
  else
    epoch_year = tle[0][18..19].to_i + 2000
  end

  epoch_yday = tle[0][20..31].to_f
  elapsed_jd = (Date.ordinal(epoch_year, epoch_yday).ajd - 2451545).to_f           # days since 2000-01-01


  if tle[0][53] == "-"
    b_star = ("-0." + tle[0][54..58]).to_f * 10**tle[0][59..60].to_f
  else
    b_star = ("0." + tle[0][54..58]).to_f * 10**tle[0][59..60].to_f
  end

if tle[0][33] == "-"
  der_1 = ("-0" + tle[0][34..42].to_s).to_f
else
  der_1 = ("0" + tle[0][34..42].to_s).to_f
end

  der_2 = ("0." + tle[0][45..49]).to_f * 10**tle[0][50..51].to_f




  sat[:norad_id] = tle[0][2..6]
  sat[:launch_date] = Date.ordinal(launch_year, launch_day).to_s
  sat[:epoch_date] = elapsed_jd
  sat[:b_star] = b_star
  sat[:inclination] = tle[1][8..15].to_f
  sat[:right_asc] = tle[1][17..24].to_f
  sat[:eccentricity] = ("0." + tle[1][26..32]).to_f
  sat[:perigee] = tle[1][34..41].to_f
  sat[:mean_anomoly] = tle[1][43..50].to_f
  sat[:mean_motion] = tle[1][52..62].to_f
  sat[:orbit_number] = tle[1][63..67].to_i
  sat[:first_derivative] = der_1
  sat[:second_derivative] = der_2

  Satellite.create(sat)
end

# need checksums at some point
